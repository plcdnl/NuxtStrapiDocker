(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[4583],{76539:(N,I,t)=>{"use strict";t.d(I,{Z:()=>n});var e=t(67294),m=t(97132),s=t(45697),o=t.n(s),h=t(68547),u=t(67109),A=t(85018),E=t(29728),f=t(67838),L=t(7681),P=t(30815),p=t(48474);const C=({onRegenerate:S,idToRegenerate:x,backUrl:j})=>{const{formatMessage:G}=(0,m.useIntl)(),[F,U]=(0,e.useState)(!1),{regenerateData:w,isLoadingConfirmation:z}=(0,p.rW)(j,x,S),$=async()=>{w(),U(!1)};return e.createElement(e.Fragment,null,e.createElement(E.z,{startIcon:e.createElement(P.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>U(!0),name:"regenerate"},G({id:"Settings.apiTokens.regenerate",defaultMessage:"Regenerate"})),e.createElement(h.ConfirmDialog,{bodyText:{id:"Settings.apiTokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:e.createElement(P.Z,null),isConfirmButtonLoading:z,isOpen:F,onToggleDialog:()=>U(!1),onConfirm:$,leftButtonText:{id:"Settings.apiTokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.apiTokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.apiTokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};C.defaultProps={onRegenerate(){}},C.propTypes={onRegenerate:o().func,idToRegenerate:o().oneOfType([o().number,o().string]).isRequired,backUrl:o().string.isRequired};const T=C,v=({title:S,token:x,setToken:j,canEditInputs:G,canRegenerate:F,isSubmitting:U,backUrl:w,regenerateUrl:z})=>{const{formatMessage:$}=(0,m.useIntl)(),X=ne=>{j({...x,accessKey:ne})};return e.createElement(f.T,{title:x?.name||$(S),primaryAction:G?e.createElement(L.K,{horizontal:!0,spacing:2},F&&x?.id&&e.createElement(T,{backUrl:z,onRegenerate:X,idToRegenerate:x?.id}),e.createElement(E.z,{disabled:U,loading:U,startIcon:e.createElement(A.Z,null),type:"submit",size:"S"},$({id:"global.save",defaultMessage:"Save"}))):F&&x?.id&&e.createElement(T,{onRegenerate:X,idToRegenerate:x?.id,backUrl:z}),navigationAction:e.createElement(h.Link,{startIcon:e.createElement(u.Z,null),to:w},$({id:"global.back",defaultMessage:"Back"}))})};v.propTypes={token:o().shape({id:o().oneOfType([o().number,o().string]),type:o().string,lifespan:o().oneOfType([o().number,o().string]),name:o().string,accessKey:o().string,permissions:o().array,description:o().string,createdAt:o().string}),canEditInputs:o().bool.isRequired,canRegenerate:o().bool.isRequired,setToken:o().func.isRequired,isSubmitting:o().bool.isRequired,backUrl:o().string.isRequired,title:o().shape({id:o().string,label:o().string}).isRequired,regenerateUrl:o().string.isRequired},v.defaultProps={token:void 0};const n=v},60401:(N,I,t)=>{"use strict";t.d(I,{Z:()=>L});var e=t(67294),m=t(45697),s=t.n(m),o=t(97132),h=t(91216),u=t(82562),A=t(75515),E=t(75056);const f=({token:P,errors:p,values:C,onChange:T,isCreating:v})=>{const{formatMessage:n}=(0,o.useIntl)();return e.createElement(e.Fragment,null,e.createElement(h.P,{name:"lifespan",label:n({id:"Settings.apiTokens.form.duration",defaultMessage:"Token duration"}),value:C.lifespan!==null?C.lifespan:"0",error:p.lifespan?n(p.lifespan?.id?p.lifespan:{id:p.lifespan,defaultMessage:p.lifespan}):null,onChange:S=>{T({target:{name:"lifespan",value:S}})},required:!0,disabled:!v,placeholder:"Select"},e.createElement(u.W,{value:"604800000"},n({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),e.createElement(u.W,{value:"2592000000"},n({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),e.createElement(u.W,{value:"7776000000"},n({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),e.createElement(u.W,{value:"0"},n({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),e.createElement(A.Z,{variant:"pi",textColor:"neutral600"},!v&&`${n({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,E.IX)(P?.createdAt,parseInt(C.lifespan,10))}`))};f.propTypes={errors:s().shape({lifespan:s().string}),onChange:s().func.isRequired,values:s().shape({lifespan:s().oneOfType([s().number,s().string])}).isRequired,isCreating:s().bool.isRequired,token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().string,name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string})},f.defaultProps={errors:{},token:{}};const L=f},24122:(N,I,t)=>{"use strict";t.d(I,{Z:()=>C});var e=t(67294),m=t(97132),s=t(45697),o=t.n(s),h=t(74855),u=t.n(h),A=t(68547),E=t.n(A),f=t(12028),L=t(65186),P=t(69427);const p=({token:T})=>{const{formatMessage:v}=(0,m.useIntl)(),n=(0,A.useNotification)(),{trackUsage:S}=(0,A.useTracking)(),x=(0,e.useRef)(S);return e.createElement(A.ContentBox,{endAction:T&&e.createElement("span",{style:{alignSelf:"start"}},e.createElement(h.CopyToClipboard,{onCopy:()=>{x.current("didCopyTokenKey"),n({type:"success",message:{id:"Settings.tokens.notification.copied"}})},text:T},e.createElement(f.h,{label:v({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),noBorder:!0,icon:e.createElement(L.Z,null),style:{padding:0,height:"1rem"}}))),title:T||v({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:v(T?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:e.createElement(P.Z,null),iconBackground:"neutral100"})};p.defaultProps={token:null},p.propTypes={token:o().string};const C=p},40695:(N,I,t)=>{"use strict";t.d(I,{Z:()=>A});var e=t(67294),m=t(45697),s=t.n(m),o=t(97132),h=t(64256);const u=({errors:E,values:f,onChange:L,canEditInputs:P})=>{const{formatMessage:p}=(0,o.useIntl)();return e.createElement(h.g,{label:p({id:"Settings.tokens.form.description",defaultMessage:"Description"}),name:"description",error:E.description?p(E.description?.id?E.description:{id:E.description,defaultMessage:E.description}):null,onChange:L,disabled:!P},f.description)};u.propTypes={errors:s().shape({description:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({description:s().string}).isRequired},u.defaultProps={errors:{}};const A=u},61053:(N,I,t)=>{"use strict";t.d(I,{Z:()=>A});var e=t(67294),m=t(45697),s=t.n(m),o=t(97132),h=t(16364);const u=({errors:E,values:f,onChange:L,canEditInputs:P})=>{const{formatMessage:p}=(0,o.useIntl)();return e.createElement(h.o,{name:"name",error:E.name?p(E.name?.id?E.name:{id:E.name,defaultMessage:E.name}):null,label:p({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:L,value:f.name,disabled:!P,required:!0})};u.propTypes={errors:s().shape({name:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({name:s().string}).isRequired},u.defaultProps={errors:{}};const A=u},24583:(N,I,t)=>{"use strict";t.d(I,{Z:()=>ze});var e=t(67294),m=t(97132),s=t(68547),o=t(185),h=t(80831),u=t(49656),A=t(23724),E=t(49066),f=t(7681),L=t(38683),P=t(75056),p=t(67838),C=t(29728),T=t(85018),v=t(45697),n=t.n(v);const S=({apiTokenName:a})=>{const{formatMessage:i}=(0,m.useIntl)();return(0,s.useFocusWhenNavigate)(),e.createElement(o.o,{"aria-busy":"true"},e.createElement(s.SettingsPageTitle,{name:"API Tokens"}),e.createElement(p.T,{primaryAction:e.createElement(C.z,{disabled:!0,startIcon:e.createElement(T.Z,null),type:"button",size:"L"},i({id:"global.save",defaultMessage:"Save"})),title:a||i({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),e.createElement(E.D,null,e.createElement(s.LoadingIndicatorPage,null)))};S.defaultProps={apiTokenName:null},S.propTypes={apiTokenName:n().string};const x=S;var j=t(87751);const G=(0,e.createContext)({}),F=({children:a,...i})=>e.createElement(G.Provider,{value:i},a),U=()=>(0,e.useContext)(G);F.propTypes={children:n().node.isRequired};const z=(a,i=[])=>({...a,selectedAction:null,routes:[],selectedActions:[],data:(0,P.mk)(i)});var $=t(18172),X=t(96486);const ne={data:{},selectedActions:[]},Ee=(a,i)=>(0,$.default)(a,r=>{switch(i.type){case"ON_CHANGE":{r.selectedActions.includes(i.value)?(0,X.pull)(r.selectedActions,i.value):r.selectedActions.push(i.value);break}case"SELECT_ALL_IN_PERMISSION":{i.value.every(c=>r.selectedActions.includes(c.actionId))?i.value.forEach(c=>{(0,X.pull)(r.selectedActions,c.actionId)}):i.value.forEach(c=>{r.selectedActions.push(c.actionId)});break}case"SELECT_ALL_ACTIONS":{r.selectedActions=[...r.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const y=r.data.allActionsIds.filter(c=>c.includes("find")||c.includes("findOne"));r.selectedActions=[...y];break}case"UPDATE_PERMISSIONS_LAYOUT":{r.data=(0,P.mk)(i.value);break}case"UPDATE_ROUTES":{r.routes={...i.value};break}case"UPDATE_PERMISSIONS":{r.selectedActions=[...i.value];break}case"SET_SELECTED_ACTION":{r.selectedAction=i.value;break}default:return r}});var K=t(75515),se=t(11276),H=t(74571),Z=t(41580),q=t(27821),fe=t(48734),ye=t(74756),Te=t(63081),ge=t(36213),he=t(11047),Ce=t(78114);const me=q.css`
  background: ${a=>a.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,ve=(0,q.default)(Z.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${a=>a.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${a=>a.isActive&&me}
  &:hover {
    ${me}
  }
`,Ae=q.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:a})=>a.colors.neutral150};
`,ae=({controllers:a,label:i,orderNumber:r,disabled:y,onExpanded:c,indexExpandendCollapsedContent:l})=>{const{value:{onChangeSelectAll:M,onChange:b,selectedActions:R,setSelectedAction:W,selectedAction:Q}}=U(),[B,ee]=(0,e.useState)(!1),{formatMessage:J}=(0,m.useIntl)(),D=()=>{ee(k=>!k),c(r)};(0,e.useEffect)(()=>{l!==null&&l!==r&&B&&ee(!1)},[l,r,B]);const Y=k=>k===Q;return e.createElement(fe.U,{expanded:B,onToggle:D,variant:r%2?"primary":"secondary"},e.createElement(ye.B,{title:(0,X.capitalize)(i)}),e.createElement(Te.v,null,a?.map(k=>{const te=k.actions.every(g=>R.includes(g.actionId)),ce=k.actions.some(g=>R.includes(g.actionId));return e.createElement(Z.x,{key:`${i}.${k?.controller}`},e.createElement(he.k,{justifyContent:"space-between",alignItems:"center",padding:4},e.createElement(Z.x,{paddingRight:4},e.createElement(K.Z,{variant:"sigma",textColor:"neutral600"},k?.controller)),e.createElement(Ae,null),e.createElement(Z.x,{paddingLeft:4},e.createElement(ge.X,{value:te,indeterminate:!te&&ce,onValueChange:()=>{M({target:{value:[...k.actions]}})},disabled:y},J({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(se.r,{gap:4,padding:4},k?.actions&&k?.actions.map(g=>e.createElement(H.P,{col:6,key:g.actionId},e.createElement(ve,{isActive:Y(g.actionId),padding:2,hasRadius:!0},e.createElement(ge.X,{value:R.includes(g.actionId),name:g.actionId,onValueChange:()=>{b({target:{value:g.actionId}})},disabled:y},g.action),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>W({target:{value:g.actionId}}),style:{display:"inline-flex",alignItems:"center"}},e.createElement(Ce.Z,null)))))))})))};ae.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ae.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};const Pe=ae,oe=({section:a,...i})=>{const[r,y]=(0,e.useState)(null),c=l=>y(l);return e.createElement(Z.x,{padding:4,background:"neutral0"},a&&a.map((l,M)=>e.createElement(Pe,{key:l.apiId,label:l.label,controllers:l.controllers,orderNumber:M,indexExpandendCollapsedContent:r,onExpanded:c,name:l.apiId,...i})))};oe.defaultProps={section:null},oe.propTypes={section:n().arrayOf(n().object)};const Me=oe;var Re=t(35161),Oe=t.n(Re),Ie=t(13217),Se=t.n(Ie);const De=a=>{switch(a){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},ke=(0,q.default)(Z.x)`
  margin: -1px;
  border-radius: ${({theme:a})=>a.spaces[1]} 0 0 ${({theme:a})=>a.spaces[1]};
`;function ie({route:a}){const{formatMessage:i}=(0,m.useIntl)(),{method:r,handler:y,path:c}=a,l=c?Se()(c.split("/")):[],[M="",b=""]=y?y.split("."):[],R=De(a.method);return e.createElement(f.K,{spacing:2},e.createElement(K.Z,{variant:"delta",as:"h3"},i({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,M),e.createElement(K.Z,{variant:"delta",textColor:"primary600"},".",b)),e.createElement(f.K,{horizontal:!0,hasRadius:!0,background:"neutral0",borderColor:"neutral200",spacing:0},e.createElement(ke,{background:R.background,borderColor:R.border,padding:2},e.createElement(K.Z,{fontWeight:"bold",textColor:R.text},r)),e.createElement(Z.x,{paddingLeft:2,paddingRight:2},Oe()(l,W=>e.createElement(K.Z,{key:W,textColor:W.includes(":")?"neutral600":"neutral900"},"/",W)))))}ie.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ie.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};const Le=ie,xe=()=>{const{value:{selectedAction:a,routes:i}}=U(),{formatMessage:r}=(0,m.useIntl)(),y=a?.split(".")[0];return e.createElement(H.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},a?e.createElement(f.K,{spacing:2},i[y]?.map(c=>c.config.auth?.scope?.includes(a)||c.handler===a?e.createElement(Le,{key:c.handler,route:c}):null)):e.createElement(f.K,{spacing:2},e.createElement(K.Z,{variant:"delta",as:"h3"},r({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),e.createElement(K.Z,{as:"p",textColor:"neutral600"},r({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},Be=({...a})=>{const{value:{data:i}}=U(),{formatMessage:r}=(0,m.useIntl)();return e.createElement(se.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(H.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(f.K,{spacing:2},e.createElement(K.Z,{variant:"delta",as:"h2"},r({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),e.createElement(K.Z,{as:"p",textColor:"neutral600"},r({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),i?.permissions&&e.createElement(Me,{section:i?.permissions,...a})),e.createElement(xe,null))},Ue=(0,e.memo)(Be);var Ke=t(60401),be=t(61053),We=t(40695),Ne=t(91216),Ze=t(82562);const re=({errors:a,values:i,onChange:r,canEditInputs:y,options:c,label:l})=>{const{formatMessage:M}=(0,m.useIntl)();return e.createElement(Ne.P,{name:"type",label:M({id:l.id,defaultMessage:l.defaultMessage}),value:i?.type,error:a.type?M(a.type?.id?a.type:{id:a.type,defaultMessage:a.type}):null,onChange:r,placeholder:"Select",required:!0,disabled:!y},c&&c.map(({value:b,label:R})=>e.createElement(Ze.W,{key:b,value:b},M(R))))};re.propTypes={options:n().arrayOf(n().shape({label:n().shape({id:n().string,defaultMessage:n().string}),value:n().string})),errors:n().shape({type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({type:n().string}).isRequired,label:n().shape({id:n().string,defaultMessage:n().string}).isRequired},re.defaultProps={errors:{},options:[]};const Fe=re,le=({errors:a,onChange:i,canEditInputs:r,isCreating:y,values:c,apiToken:l,onDispatch:M,setHasChangedPermissions:b})=>{const{formatMessage:R}=(0,m.useIntl)(),W=({target:{value:B}})=>{b(!1),B==="full-access"&&M({type:"SELECT_ALL_ACTIONS"}),B==="read-only"&&M({type:"ON_CHANGE_READ_ONLY"})},Q=[{value:"read-only",label:{id:"Settings.apiTokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.apiTokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.apiTokens.types.custom",defaultMessage:"Custom"}}];return e.createElement(Z.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(f.K,{spacing:4},e.createElement(K.Z,{variant:"delta",as:"h2"},R({id:"global.details",defaultMessage:"Details"})),e.createElement(se.r,{gap:5},e.createElement(H.P,{key:"name",col:6,xs:12},e.createElement(be.Z,{errors:a,values:c,canEditInputs:r,onChange:i})),e.createElement(H.P,{key:"description",col:6,xs:12},e.createElement(We.Z,{errors:a,values:c,canEditInputs:r,onChange:i})),e.createElement(H.P,{key:"lifespan",col:6,xs:12},e.createElement(Ke.Z,{isCreating:y,errors:a,values:c,onChange:i,token:l})),e.createElement(H.P,{key:"type",col:6,xs:12},e.createElement(Fe,{values:c,errors:a,label:{id:"Settings.apiTokens.form.type",defaultMessage:"Token type"},onChange:B=>{W({target:{value:B}}),i({target:{name:"type",value:B}})},options:Q,canEditInputs:r})))))};le.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},le.defaultProps={errors:{},apiToken:{}};const $e=le;var He=t(24122),Ve=t(76539);const Ge="Name already taken",ze=()=>{(0,s.useFocusWhenNavigate)();const{formatMessage:a}=(0,m.useIntl)(),{lockApp:i,unlockApp:r}=(0,s.useOverlayBlocker)(),y=(0,s.useNotification)(),c=(0,u.useHistory)(),[l,M]=(0,e.useState)(c.location.state?.apiToken.accessKey?{...c.location.state.apiToken}:null),{trackUsage:b}=(0,s.useTracking)(),R=(0,e.useRef)(b),{setCurrentStep:W}=(0,s.useGuidedTour)(),{allowedActions:{canCreate:Q,canUpdate:B,canRegenerate:ee}}=(0,s.useRBAC)(j.Z.settings["api-tokens"]),[J,D]=(0,e.useReducer)(Ee,ne,d=>z(d,{})),{params:{id:Y}}=(0,u.useRouteMatch)("/settings/api-tokens/:id"),{get:k,post:te,put:ce}=(0,s.useFetchClient)(),g=Y==="create";(0,A.useQuery)("content-api-permissions",async()=>{const[d,V]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async _=>{const{data:O}=await k(_);return O.data}));D({type:"UPDATE_PERMISSIONS_LAYOUT",value:d}),D({type:"UPDATE_ROUTES",value:V}),l&&(l?.type==="read-only"&&D({type:"ON_CHANGE_READ_ONLY"}),l?.type==="full-access"&&D({type:"SELECT_ALL_ACTIONS"}),l?.type==="custom"&&D({type:"UPDATE_PERMISSIONS",value:l?.permissions}))},{onError(){y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,e.useEffect)(()=>{R.current(g?"didAddTokenFromList":"didEditTokenFromList")},[g]);const{status:Xe}=(0,A.useQuery)(["api-token",Y],async()=>{const{data:{data:d}}=await k(`/admin/api-tokens/${Y}`);return M({...d}),d?.type==="read-only"&&D({type:"ON_CHANGE_READ_ONLY"}),d?.type==="full-access"&&D({type:"SELECT_ALL_ACTIONS"}),d?.type==="custom"&&D({type:"UPDATE_PERMISSIONS",value:d?.permissions}),d},{enabled:!g&&!l,onError(){y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Ye=async(d,V)=>{R.current(g?"willCreateToken":"willEditToken"),i();const _=d.lifespan&&parseInt(d.lifespan,10)&&d.lifespan!=="0"?parseInt(d.lifespan,10):null;try{const{data:{data:O}}=g?await te("/admin/api-tokens",{...d,lifespan:_,permissions:d.type==="custom"?J.selectedActions:null}):await ce(`/admin/api-tokens/${Y}`,{name:d.name,description:d.description,type:d.type,permissions:d.type==="custom"?J.selectedActions:null});g&&(c.replace(`/settings/api-tokens/${O.id}`,{apiToken:O}),W("apiTokens.success")),r(),M({...O}),y({type:"success",message:a(g?{id:"notification.success.tokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.tokenedited",defaultMessage:"API Token successfully edited"})}),R.current(g?"didCreateToken":"didEditToken",{type:l.type})}catch(O){const ue=(0,L.Iz)(O.response.data);V.setErrors(ue),O?.response?.data?.error?.message===Ge?y({type:"warning",message:O.response.data.message||"notification.error.tokennamenotunique"}):y({type:"warning",message:O?.response?.data?.message||"notification.error"}),r()}},[je,de]=(0,e.useState)(!1),Qe={...J,onChange:({target:{value:d}})=>{de(!0),D({type:"ON_CHANGE",value:d})},onChangeSelectAll:({target:{value:d}})=>{de(!0),D({type:"SELECT_ALL_IN_PERMISSION",value:d})},setSelectedAction:({target:{value:d}})=>{D({type:"SET_SELECTED_ACTION",value:d})}},pe=B&&!g||Q&&g;return!g&&!l&&Xe!=="success"?e.createElement(x,{apiTokenName:l?.name}):e.createElement(F,{value:Qe},e.createElement(o.o,null,e.createElement(s.SettingsPageTitle,{name:"API Tokens"}),e.createElement(h.Formik,{validationSchema:P.fK,validateOnChange:!1,initialValues:{name:l?.name||"",description:l?.description||"",type:l?.type,lifespan:l?.lifespan?l.lifespan.toString():l?.lifespan},enableReinitialize:!0,onSubmit:(d,V)=>Ye(d,V)},({errors:d,handleChange:V,isSubmitting:_,values:O,setFieldValue:ue})=>(je&&O?.type!=="custom"&&ue("type","custom"),e.createElement(s.Form,null,e.createElement(Ve.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:l,setToken:M,canEditInputs:pe,canRegenerate:ee,isSubmitting:_,regenerateUrl:"/admin/api-tokens/"}),e.createElement(E.D,null,e.createElement(f.K,{spacing:6},Boolean(l?.name)&&e.createElement(He.Z,{token:l?.accessKey}),e.createElement($e,{errors:d,onChange:V,canEditInputs:pe,isCreating:g,values:O,apiToken:l,onDispatch:D,setHasChangedPermissions:de}),e.createElement(Ue,{disabled:!pe||O?.type==="read-only"||O?.type==="full-access"}))))))))}},75056:(N,I,t)=>{"use strict";t.d(I,{IX:()=>o,fK:()=>E,mk:()=>P});var e=t(47292),m=t(73825);const o=(p,C,T="en")=>{if(C&&typeof C=="number"){const v=C/24/60/60/1e3;return(0,e.format)((0,e.addDays)(new Date(p),v),"PPP",{locale:m[T]})}return"Unlimited"};var h=t(53209),u=t(68547);const E=h.Ry().shape({name:h.Z_(u.translatedErrors.string).required(u.translatedErrors.required),type:h.Z_(u.translatedErrors.string).oneOf(["read-only","full-access","custom"]).required(u.translatedErrors.required),description:h.Z_().nullable(),lifespan:h.Rx().integer().min(0).nullable().defined(u.translatedErrors.required)});var f=t(96486);const P=p=>{const C={allActionsIds:[],permissions:[]};return C.permissions=Object.keys(p).map(T=>({apiId:T,label:T.split("::")[1],controllers:(0,f.flatten)(Object.keys(p[T].controllers).map(v=>({controller:v,actions:(0,f.flatten)(p[T].controllers[v].map(n=>{const S=`${T}.${v}.${n}`;return T.includes("api::")&&C.allActionsIds.push(S),{action:n,actionId:S}}))})))})),C}},13217:(N,I,t)=>{var e=t(14259);function m(s){var o=s==null?0:s.length;return o?e(s,1,o):[]}N.exports=m}}]);
