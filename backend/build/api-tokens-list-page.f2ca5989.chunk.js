"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[8056],{56856:(j,L,t)=>{t.d(L,{Z:()=>E});var e=t(67294),n=t(49656),b=t(45697),a=t.n(b),u=t(75515),N=t(550),B=t(47144),p=t(18374),U=t(11047),l=t(68547),V=t(20022),Z=t(12028),D=t(41580),x=t(97132);const M=({tokenName:s,onClickDelete:r})=>{const{formatMessage:g}=(0,x.useIntl)(),{trackUsage:T}=(0,l.useTracking)();return e.createElement(D.x,{paddingLeft:1,...l.stopPropagation},e.createElement(Z.h,{onClick:()=>{T("willDeleteToken"),r()},label:g({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${s}`}),name:"delete",noBorder:!0,icon:e.createElement(V.default,null)}))};M.propTypes={tokenName:a().string.isRequired,onClickDelete:a().func.isRequired};const F=M;var w=t(4585),$=t(27821);const z={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},H=(0,$.default)(l.Link)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:s})=>s.colors.neutral800};
      }
    }
  }
`,A=({tokenName:s,tokenId:r,buttonType:g,children:T})=>{const{formatMessage:k}=(0,x.useIntl)(),{location:{pathname:d}}=(0,n.useHistory)();return e.createElement(H,{to:`${d}/${r}`,title:k(z[g],{target:s})},T)};A.propTypes={tokenName:a().string.isRequired,tokenId:a().oneOfType([a().string,a().number]).isRequired,buttonType:a().string,children:a().node.isRequired},A.defaultProps={buttonType:"edit"};const m=A,f=({tokenName:s,tokenId:r})=>e.createElement(m,{tokenName:s,tokenId:r},e.createElement(w.Z,null));f.propTypes={tokenName:a().string.isRequired,tokenId:a().oneOfType([a().string,a().number]).isRequired};const C=f;var O=t(8934);const S=({tokenName:s,tokenId:r})=>e.createElement(m,{tokenName:s,tokenId:r,buttonType:"read"},e.createElement(O.default,null));S.propTypes={tokenName:a().string.isRequired,tokenId:a().oneOfType([a().string,a().number]).isRequired};const c=S,y=({permissions:s,headers:r,contentType:g,isLoading:T,tokens:k,onConfirmDelete:d})=>{const{canDelete:v,canUpdate:h,canRead:R}=s,P=v||h||R,[{query:I}]=(0,l.useQueryParams)(),[,Q]=I?I.sort.split(":"):"ASC",{push:W,location:{pathname:o}}=(0,n.useHistory)(),{trackUsage:Y}=(0,l.useTracking)(),J=k.sort((i,K)=>{const G=i.name.localeCompare(K.name);return Q==="DESC"?-G:G});return e.createElement(l.DynamicTable,{headers:r,contentType:g,rows:k,withBulkActions:P,isLoading:T,onConfirmDelete:d},e.createElement(N.p,null,J.map(i=>e.createElement(B.Tr,{key:i.id,...(0,l.onRowClick)({fn(){Y("willEditTokenFromList"),W(`${o}/${i.id}`)},condition:h})},e.createElement(p.Td,null,e.createElement(u.Z,{textColor:"neutral800",fontWeight:"bold"},i.name)),e.createElement(p.Td,{maxWidth:(0,l.pxToRem)(250)},e.createElement(u.Z,{textColor:"neutral800",ellipsis:!0},i.description)),e.createElement(p.Td,null,e.createElement(u.Z,{textColor:"neutral800"},e.createElement(l.RelativeTime,{timestamp:new Date(i.createdAt)}))),e.createElement(p.Td,null,i.lastUsedAt&&e.createElement(u.Z,{textColor:"neutral800"},e.createElement(l.RelativeTime,{timestamp:new Date(i.lastUsedAt)}))),P&&e.createElement(p.Td,null,e.createElement(U.k,{justifyContent:"end"},h&&e.createElement(C,{tokenName:i.name,tokenId:i.id}),!h&&R&&e.createElement(c,{tokenName:i.name,tokenId:i.id}),v&&e.createElement(F,{tokenName:i.name,onClickDelete:()=>d(i.id)})))))))};y.propTypes={tokens:a().array,permissions:a().shape({canRead:a().bool,canDelete:a().bool,canUpdate:a().bool}).isRequired,headers:a().arrayOf(a().shape({cellFormatter:a().func,key:a().string.isRequired,metadatas:a().shape({label:a().string.isRequired,sortable:a().bool}).isRequired,name:a().string.isRequired})),contentType:a().string.isRequired,isLoading:a().bool,onConfirmDelete:a().func},y.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const E=y},87427:(j,L,t)=>{t.r(L),t.d(L,{default:()=>H});var e=t(67294),n=t(68547),b=t(87751),a=t(97132),u=t(23724),N=t(49656),B=t(80129),p=t.n(B),U=t(67838),l=t(49066),V=t(185),Z=t(29728),D=t(96315);const M=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}];var F=t(56856);const $=()=>{(0,n.useFocusWhenNavigate)();const A=(0,u.useQueryClient)(),{formatMessage:m}=(0,a.useIntl)(),f=(0,n.useNotification)(),{allowedActions:{canCreate:C,canDelete:O,canUpdate:S,canRead:c}}=(0,n.useRBAC)(b.Z.settings["api-tokens"]),{push:y}=(0,N.useHistory)(),{trackUsage:E}=(0,n.useTracking)(),{startSection:s}=(0,n.useGuidedTour)(),r=(0,e.useRef)(s),{get:g,del:T}=(0,n.useFetchClient)();(0,e.useEffect)(()=>{r.current&&r.current("apiTokens")},[]),(0,e.useEffect)(()=>{y({search:p().stringify({sort:"name:ASC"},{encode:!1})})},[y]);const k=M.map(o=>({...o,metadatas:{...o.metadatas,label:m(o.metadatas.label)}})),{data:d,status:v,isFetching:h}=(0,u.useQuery)(["api-tokens"],async()=>{E("willAccessTokenList");const{data:{data:o}}=await g("/admin/api-tokens");return E("didAccessTokenList",{number:o.length}),o},{enabled:c,onError(){f({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),R=c&&(v!=="success"&&v!=="error"||v==="success"&&h),P=(0,u.useMutation)(async o=>{await T(`/admin/api-tokens/${o}`)},{async onSuccess(){await A.invalidateQueries(["api-tokens"]),E("didDeleteToken")},onError(o){o?.response?.data?.data?f({type:"warning",message:o.response.data.data}):f({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),I=c&&d,Q=c&&!d&&!C,W=c&&!d&&C;return e.createElement(V.o,{"aria-busy":R},e.createElement(n.SettingsPageTitle,{name:"API Tokens"}),e.createElement(U.T,{title:m({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:m({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:C?e.createElement(n.LinkButton,{"data-testid":"create-api-token-button",startIcon:e.createElement(D.default,null),size:"S",onClick:()=>E("willAddTokenFromList"),to:"/settings/api-tokens/create"},m({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})):void 0}),e.createElement(l.D,null,!c&&e.createElement(n.NoPermissions,null),I&&e.createElement(F.Z,{permissions:{canRead:c,canDelete:O,canUpdate:S},headers:k,contentType:"api-tokens",rows:d,isLoading:R,onConfirmDelete:o=>P.mutateAsync(o),tokens:d}),W&&e.createElement(n.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(Z.z,{variant:"secondary",startIcon:e.createElement(D.default,null)},m({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),Q&&e.createElement(n.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},H=()=>e.createElement(n.CheckPagePermissions,{permissions:b.Z.settings["api-tokens"].main},e.createElement($,null))}}]);
